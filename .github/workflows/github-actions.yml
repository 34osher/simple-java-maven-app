name: GitHub Actions simple project
run-name: ${{ github.actor }} is testing out GitHub Actions ğŸš€
on: 
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]
jobs:
  build-and-test-maven:
    runs-on: ubuntu-latest
    steps:
      - run: echo "ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."

      - name: Check out repository code
        uses: actions/checkout@v2
      - run: echo "ğŸ’¡ The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "ğŸ–¥ï¸ The workflow is now ready to test your code on the runner."

      - name: Set up Java
        uses: actions/setup-java@v2
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Build with Maven
        run: mvn clean install

      - name: Run tests
        run: mvn test

      - name: Build docker images
        run: | 
          echo "---Building images and starting up docker---"
          echo "## The ${{ github.ref }} lllllllll"    
          docker build -t ${{  github.repository }}:latest .

      - name: set the new patch version
        run: |
          VERSION=$(echo version.txt)
          echo " $VERSION "

      - name: continue delivery 
        run: | 
          docker login -u ${{ secrets.USER_DOCKERHUB }}-p ${{ secrets.PASS_DOCKERHUB }}
          docker tag ${{  github.repository }}:${{ VERSION }}

          docker push ${{  github.repository }}:${{ VERSION }}
          docker push 34osher/weather_app:latest


    #  - name: package to docker image
     #   runs:
      #    using: 'docker'
       #   image: 'Dockerfile'   

      #- name: Extract JAR version
       # id: extract-jar-version
        #run: |
         # jar_version=$(grep -o '<version>.*</version>' pom.xml | head -n1 | sed 's/<[^>]*>//g')
          #echo "JAR version: $jar_version"    
            
     
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
      - run: echo "ğŸ This job's status is ${{ job.status }}."

